from retic.runtime import *
from retic.transient import *
from retic.typing import *
import optparse
import time
import util
from compat import xrange


class Foo(retic_actual(object)):
    retic_class_type = Class('Foo', {'bar': Function(NamedParameters([('self', TypeVariable('Foo')), ('a', Int), ('b', Int), ('c', Int)]), Dyn), 'foo': Function(NamedParameters([('self', TypeVariable('Foo')), ('a', Int), ('b', Int), ('c', Int), ('d', Int)]), Dyn), 'baz': Function(NamedParameters([('self', TypeVariable('Foo')), ('a', Int), ('b', Int)]), Dyn), 'qux': Function(NamedParameters([('self', Dyn)]), Dyn), 'quux': Function(NamedParameters([('self', TypeVariable('Foo')), ('a', Int)]), Dyn), }, {})

    def foo(self, a, b, c, d):
        check_type_object(self, ['bar', 'foo', 'baz', 'qux', 'quux'])
        check_type_int(a)
        check_type_int(b)
        check_type_int(c)
        check_type_int(d)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
        check_type_function(self.bar)(a, b, c)
    foo = check_type_function(foo)

    def bar(self, a, b, c):
        check_type_object(self, ['bar', 'foo', 'baz', 'qux', 'quux'])
        check_type_int(a)
        check_type_int(b)
        check_type_int(c)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
        check_type_function(self.baz)(a, b)
    bar = check_type_function(bar)

    def baz(self, a, b):
        check_type_object(self, ['bar', 'foo', 'baz', 'qux', 'quux'])
        check_type_int(a)
        check_type_int(b)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
        check_type_function(self.quux)(a)
    baz = check_type_function(baz)

    def quux(self, a):
        check_type_object(self, ['bar', 'foo', 'baz', 'qux', 'quux'])
        check_type_int(a)
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
        check_type_function(self.qux)()
    quux = check_type_function(quux)

    def qux(self):
        pass
    qux = check_type_function(qux)
Foo = check_type_class(Foo, ['bar', 'foo', 'baz', 'qux', 'quux'])

def test_calls(iterations, timer):
    check_type_int(iterations)
    times = []
    f = check_type_object(Foo(), ['bar', 'foo', 'baz', 'qux', 'quux'])
    for _ in check_type_function(xrange)(iterations):
        t0 = check_type_function(timer)()
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        check_type_function(f.foo)(1, 2, 3, 4)
        t1 = check_type_function(timer)()
        check_type_void(check_type_function(times.append)((t1 - t0)))
    return times
test_calls = check_type_function(test_calls)
if (__name__ == '__main__'):
    parser = check_type_function(check_type_object(optparse, ['OptionParser']).OptionParser)(usage='%prog [options] [test]', description='Test the performance of simple Python-to-Python method calls.')
    check_type_function(util.add_standard_options_to)(parser)
    (options, _) = check_type_tuple(check_type_function(check_type_object(parser, ['parse_args']).parse_args)(), 2)
    test_calls(1, check_type_object(time, ['time']).time)
    check_type_function(util.run_benchmark)(options, check_type_object(options, ['num_runs']).num_runs, test_calls)
